import { NextResponse } from "next/server";

export interface ClauseListItem {
  id: string;
  originalClause: string; // Исходная проблемная формулировка
  problemDescription: string; // Краткое описание проблемы
  riskType: "неопределённость" | "неформализованность" | "открытый перечень" | "нарушение процедуры" | "несбалансированность" | "спорная трактовка";
  severity: "low" | "medium" | "high" | "critical";
  aiRecommendation: string; // Улучшенная формулировка от AI
  aiExplanation?: string; // AI-пояснение разницы между формулировками
  impact: string; // Как риск влияет на позиции сторон
  category: string; // Категория: оплата, ответственность, сроки, приемка, документооборот, интеллектуальная собственность, прочее
  tags?: string[]; // Дополнительные теги
  disputeProbability?: number; // Вероятность спора (0-100)
  problematicElements?: string[]; // Проблемные элементы формулировки
  occurrenceData?: {
    totalOccurrences: number; // Сколько раз встречалась
    contracts: Array<{
      contractId: string;
      contractNumber?: string;
      contractName?: string;
    }>;
    risksGenerated: number; // Сколько рисков породила
  };
}

// Генерируем mockup данные с типичными проблемными формулировками
function generateMockClauses(): ClauseListItem[] {
  const clauses: ClauseListItem[] = [
    {
      id: "clause_1",
      originalClause: "Оплата производится по факту выполнения работ.",
      problemDescription: "Отсутствие конкретных сроков оплаты создает неопределенность и может привести к задержкам платежей.",
      riskType: "неопределённость",
      severity: "high",
      aiRecommendation: "Оплата производится Заказчиком в течение 10 (десяти) рабочих дней с момента подписания Сторонами акта сдачи-приемки выполненных работ, но не позднее 15 (пятнадцатого) числа месяца, следующего за месяцем выполнения работ.",
      impact: "Исполнитель не может планировать денежные потоки, возможны задержки оплаты без четких последствий для Заказчика.",
      category: "оплата",
      tags: ["сроки", "неопределенность"],
      disputeProbability: 75,
      problematicElements: [
        "Отсутствие конкретного срока оплаты",
        "Неопределенность момента 'факта выполнения'",
        "Отсутствие последствий просрочки"
      ],
      aiExplanation: "Разница в юридическом смысле заключается в том, что исходная формулировка создает полную неопределенность момента оплаты, что позволяет Заказчику затягивать платежи без последствий. Улучшенная формулировка устанавливает четкий механизм: конкретный срок (10 рабочих дней), привязку к документу (акт сдачи-приемки) и верхний предел (15 число месяца), что исключает возможность произвольной задержки и создает предсказуемость для обеих сторон.",
      occurrenceData: {
        totalOccurrences: 23,
        contracts: [
          { contractId: "contr1", contractNumber: "43/25" },
          { contractId: "contr2", contractNumber: "46/25" },
          { contractId: "contr3", contractNumber: "12/24" },
        ],
        risksGenerated: 18,
      },
    },
    {
      id: "clause_2",
      originalClause: "Исполнитель несет ответственность за качество работ.",
      problemDescription: "Формулировка слишком общая, не определяет конкретные виды ответственности и размеры санкций.",
      riskType: "неформализованность",
      severity: "medium",
      aiRecommendation: "Исполнитель несет ответственность за ненадлежащее качество выполненных работ в соответствии с законодательством РФ. При обнаружении недостатков в течение гарантийного срока Исполнитель обязуется устранить их за свой счет в течение 10 рабочих дней. За каждый день просрочки устранения недостатков Исполнитель уплачивает Заказчику неустойку в размере 0,1% от стоимости работ, но не более 10% от общей суммы договора.",
      impact: "Сложность доказывания нарушений и взыскания убытков из-за отсутствия конкретных критериев качества и санкций.",
      category: "ответственность",
      tags: ["качество", "санкции"],
      disputeProbability: 60,
      problematicElements: [
        "Отсутствие критериев качества",
        "Неопределенность размера ответственности",
        "Отсутствие механизма взыскания"
      ],
      aiExplanation: "Исходная формулировка содержит лишь общую отсылку к законодательству, что требует дополнительного толкования и доказывания. Улучшенная версия конкретизирует: определяет гарантийный срок, устанавливает механизм устранения недостатков с конкретными сроками, вводит неустойку с четким расчетом и ограничением, а также предусматривает основания освобождения от ответственности, что делает формулировку самодостаточной и защищенной.",
      occurrenceData: {
        totalOccurrences: 31,
        contracts: [
          { contractId: "contr1", contractNumber: "43/25" },
          { contractId: "contr2", contractNumber: "46/25" },
        ],
        risksGenerated: 25,
      },
    },
    {
      id: "clause_3",
      originalClause: "Срок выполнения работ определяется по согласованию сторон.",
      problemDescription: "Открытая формулировка без конкретных временных рамок создает риск бесконечного затягивания проекта.",
      riskType: "открытый перечень",
      severity: "high",
      aiRecommendation: "Срок выполнения работ составляет 60 (шестьдесят) календарных дней с момента подписания настоящего договора. По согласованию Сторон срок выполнения работ может быть изменен путем подписания дополнительного соглашения к настоящему договору.",
      impact: "Отсутствие дедлайнов позволяет любой из сторон затягивать процесс, что создает риски для обеих сторон.",
      category: "сроки",
      tags: ["дедлайны", "планирование"],
      disputeProbability: 70,
      problematicElements: [
        "Отсутствие конкретного срока",
        "Неопределенность момента начала отсчета",
        "Отсутствие механизма изменения сроков"
      ],
      aiExplanation: "Исходная формулировка полностью делегирует определение сроков на будущее, что создает риск бесконечного затягивания проекта. Улучшенная версия устанавливает конкретный срок (60 дней), четкую точку отсчета (подписание договора) и формализованный механизм изменения сроков через дополнительное соглашение, что обеспечивает планируемость и защиту интересов обеих сторон.",
      occurrenceData: {
        totalOccurrences: 15,
        contracts: [
          { contractId: "contr1", contractNumber: "43/25" },
          { contractId: "contr3", contractNumber: "12/24" },
        ],
        risksGenerated: 12,
      },
    },
    {
      id: "clause_4",
      originalClause: "Приемка работ осуществляется Заказчиком.",
      problemDescription: "Не определены сроки приемки, порядок оформления акта и последствия отказа от приемки.",
      riskType: "нарушение процедуры",
      severity: "medium",
      aiRecommendation: "Приемка выполненных работ осуществляется Заказчиком в течение 5 (пяти) рабочих дней с момента получения уведомления от Исполнителя о готовности работ. Акт сдачи-приемки подписывается обеими сторонами. В случае неподписания акта Заказчиком в течение указанного срока без мотивированного отказа работы считаются принятыми. При наличии замечаний Заказчик направляет Исполнителю мотивированный отказ в течение 3 рабочих дней.",
      impact: "Исполнитель не может закрыть проект и получить оплату, возможны споры о моменте приемки и качестве работ.",
      category: "приемка",
      tags: ["процедура", "акт"],
      disputeProbability: 65,
      problematicElements: [
        "Отсутствие сроков приемки",
        "Неопределенность порядка оформления",
        "Отсутствие последствий отказа"
      ],
      aiExplanation: "Исходная формулировка не определяет процедуру приемки, что создает риск затягивания процесса и споров о моменте приемки. Улучшенная версия устанавливает четкие сроки (5 дней), порядок оформления акта, последствия молчания (автоматическая приемка) и механизм мотивированного отказа, что защищает интересы обеих сторон и исключает возможность злоупотреблений.",
      occurrenceData: {
        totalOccurrences: 19,
        contracts: [
          { contractId: "contr1", contractNumber: "43/25" },
          { contractId: "contr2", contractNumber: "46/25" },
        ],
        risksGenerated: 15,
      },
    },
    {
      id: "clause_5",
      originalClause: "Все права на результаты работ принадлежат Заказчику.",
      problemDescription: "Не определен момент перехода прав, объем прав и возможность использования Исполнителем.",
      riskType: "спорная трактовка",
      severity: "high",
      aiRecommendation: "Исключительные права на результаты интеллектуальной деятельности, созданные в рамках выполнения настоящего договора, переходят к Заказчику с момента подписания акта сдачи-приемки работ. Исполнитель сохраняет право использовать результаты работ для собственных нужд и в портфолио при условии указания авторства. Заказчик вправе использовать результаты работ любым способом без ограничений.",
      impact: "Споры о принадлежности прав, возможности использования результатов работ третьими лицами и автором.",
      category: "интеллектуальная собственность",
      tags: ["права", "авторство"],
      disputeProbability: 80,
      problematicElements: [
        "Неопределенность момента перехода прав",
        "Отсутствие определения объема прав",
        "Неясность возможности использования Исполнителем"
      ],
      aiExplanation: "Исходная формулировка использует общее понятие 'все права', что не определяет момент перехода и объем прав, создавая риск споров. Улучшенная версия конкретизирует: указывает на исключительные права, определяет момент перехода (подписание акта), сохраняет права Исполнителя на использование в портфолио и четко определяет объем прав Заказчика, что исключает двусмысленность.",
      occurrenceData: {
        totalOccurrences: 12,
        contracts: [
          { contractId: "contr1", contractNumber: "43/25" },
          { contractId: "contr3", contractNumber: "12/24" },
        ],
        risksGenerated: 10,
      },
    },
    {
      id: "clause_6",
      originalClause: "Стороны обязуются соблюдать конфиденциальность.",
      problemDescription: "Не определены конкретные сведения, составляющие коммерческую тайну, сроки и объем обязательств.",
      riskType: "неформализованность",
      severity: "medium",
      aiRecommendation: "Стороны обязуются не разглашать конфиденциальную информацию, полученную в ходе исполнения договора, в течение 3 (трех) лет после его окончания. К конфиденциальной информации относятся: технические решения, коммерческие условия, данные о клиентах и партнерах, финансовые показатели. Обязательство не распространяется на информацию, ставшую общедоступной не по вине стороны, полученную от третьих лиц или раскрытую по требованию закона.",
      impact: "Сложность доказывания нарушения конфиденциальности и взыскания убытков из-за неопределенности предмета защиты.",
      category: "конфиденциальность",
      tags: ["коммерческая тайна", "обязательства"],
      disputeProbability: 55,
      problematicElements: [
        "Отсутствие определения конфиденциальной информации",
        "Неопределенность срока действия обязательства",
        "Отсутствие исключений"
      ],
      aiExplanation: "Исходная формулировка содержит лишь общее обязательство без конкретизации предмета защиты, что делает невозможным доказывание нарушения. Улучшенная версия определяет конкретные виды конфиденциальной информации, устанавливает срок действия обязательства (3 года) и предусматривает исключения (общедоступная информация, информация от третьих лиц, требования закона), что делает формулировку защищенной и применимой.",
      occurrenceData: {
        totalOccurrences: 27,
        contracts: [
          { contractId: "contr1", contractNumber: "43/25" },
          { contractId: "contr2", contractNumber: "46/25" },
          { contractId: "contr3", contractNumber: "12/24" },
        ],
        risksGenerated: 20,
      },
    },
    {
      id: "clause_7",
      originalClause: "Договор может быть изменен по согласованию сторон.",
      problemDescription: "Не определен порядок внесения изменений, форма согласования и последствия несогласованных изменений.",
      riskType: "нарушение процедуры",
      severity: "low",
      aiRecommendation: "Изменения и дополнения к настоящему договору оформляются в письменной форме путем подписания дополнительного соглашения обеими сторонами. Дополнительное соглашение является неотъемлемой частью настоящего договора. Одностороннее изменение условий договора не допускается, за исключением случаев, прямо предусмотренных законодательством РФ.",
      impact: "Риск признания изменений недействительными из-за несоблюдения формы и порядка согласования.",
      category: "изменение договора",
      tags: ["процедура", "дополнительное соглашение"],
      disputeProbability: 40,
      problematicElements: [
        "Отсутствие требования письменной формы",
        "Неопределенность порядка согласования",
        "Отсутствие запрета односторонних изменений"
      ],
      aiExplanation: "Исходная формулировка не определяет форму и порядок изменений, что создает риск признания изменений недействительными. Улучшенная версия требует письменную форму (дополнительное соглашение), определяет его статус (неотъемлемая часть договора) и запрещает односторонние изменения, что обеспечивает юридическую защищенность и предсказуемость.",
      occurrenceData: {
        totalOccurrences: 8,
        contracts: [
          { contractId: "contr2", contractNumber: "46/25" },
        ],
        risksGenerated: 5,
      },
    },
    {
      id: "clause_8",
      originalClause: "Документооборот осуществляется в электронном виде.",
      problemDescription: "Не определены используемые системы, порядок подписания, юридическая сила документов и порядок хранения.",
      riskType: "неформализованность",
      severity: "medium",
      aiRecommendation: "Документооборот между Сторонами осуществляется в электронном виде через систему электронного документооборота [название системы] с использованием усиленной квалифицированной электронной подписи. Электронные документы имеют равную юридическую силу с документами на бумажном носителе. Стороны обязуются обеспечить хранение электронных документов в течение 5 лет после окончания срока действия договора.",
      impact: "Споры о юридической силе документов, порядке подписания и возможности использования в суде.",
      category: "электронный документооборот",
      tags: ["ЭДО", "электронная подпись"],
      disputeProbability: 50,
      problematicElements: [
        "Отсутствие указания системы ЭДО",
        "Неопределенность вида электронной подписи",
        "Отсутствие требований к хранению"
      ],
      aiExplanation: "Исходная формулировка не определяет технические и юридические параметры электронного документооборота, что создает риск споров о юридической силе документов. Улучшенная версия конкретизирует систему ЭДО, вид электронной подписи (усиленная квалифицированная), подтверждает юридическую силу и устанавливает срок хранения (5 лет), что обеспечивает полную юридическую защищенность.",
      occurrenceData: {
        totalOccurrences: 14,
        contracts: [
          { contractId: "contr1", contractNumber: "43/25" },
          { contractId: "contr3", contractNumber: "12/24" },
        ],
        risksGenerated: 9,
      },
    },
    {
      id: "clause_9",
      originalClause: "За нарушение сроков Исполнитель уплачивает штраф.",
      problemDescription: "Не определен размер штрафа, порядок его взыскания и возможность освобождения от ответственности.",
      riskType: "неформализованность",
      severity: "high",
      aiRecommendation: "За нарушение срока выполнения работ Исполнитель уплачивает Заказчику неустойку в размере 0,5% от стоимости невыполненных в срок работ за каждый день просрочки, но не более 20% от общей стоимости работ по договору. Неустойка взыскивается на основании письменного требования Заказчика и подлежит уплате в течение 10 рабочих дней. Исполнитель освобождается от уплаты неустойки, если просрочка произошла по вине Заказчика или вследствие обстоятельств непреодолимой силы.",
      impact: "Сложность взыскания неустойки из-за неопределенности размера и порядка расчета, возможные споры о вине.",
      category: "ответственность",
      tags: ["неустойка", "санкции"],
      disputeProbability: 70,
      problematicElements: [
        "Отсутствие размера штрафа",
        "Неопределенность порядка расчета",
        "Отсутствие ограничения размера"
      ],
      aiExplanation: "Исходная формулировка не определяет размер и порядок взыскания штрафа, что делает его фактически неприменимым. Улучшенная версия устанавливает конкретный размер неустойки (0,5% за день), ограничение максимального размера (20%), порядок взыскания (письменное требование, срок уплаты) и основания освобождения от ответственности, что делает формулировку самодостаточной и защищенной.",
      occurrenceData: {
        totalOccurrences: 35,
        contracts: [
          { contractId: "contr1", contractNumber: "43/25" },
          { contractId: "contr2", contractNumber: "46/25" },
          { contractId: "contr3", contractNumber: "12/24" },
        ],
        risksGenerated: 28,
      },
    },
    {
      id: "clause_10",
      originalClause: "Гарантийный срок составляет разумный период.",
      problemDescription: "Понятие 'разумный период' является оценочным и может трактоваться по-разному сторонами.",
      riskType: "спорная трактовка",
      severity: "medium",
      aiRecommendation: "Гарантийный срок на выполненные работы составляет 12 (двенадцать) месяцев с момента подписания акта сдачи-приемки работ. В течение гарантийного срока Исполнитель обязуется безвозмездно устранять выявленные недостатки, возникшие по его вине. Гарантийный срок продлевается на период устранения недостатков, но не более чем на 3 месяца.",
      impact: "Споры о длительности гарантийного срока и моменте его начала, сложность определения 'разумности' периода.",
      category: "гарантии",
      tags: ["гарантийный срок", "недостатки"],
      disputeProbability: 60,
      problematicElements: [
        "Использование оценочного понятия",
        "Отсутствие конкретного срока",
        "Неопределенность момента начала отсчета"
      ],
      aiExplanation: "Исходная формулировка использует оценочное понятие 'разумный период', что создает риск споров о его длительности. Улучшенная версия устанавливает конкретный срок (12 месяцев), определяет момент начала отсчета (подписание акта), механизм продления срока при устранении недостатков и ограничение продления (не более 3 месяцев), что исключает возможность произвольной трактовки.",
      occurrenceData: {
        totalOccurrences: 18,
        contracts: [
          { contractId: "contr2", contractNumber: "46/25" },
          { contractId: "contr3", contractNumber: "12/24" },
        ],
        risksGenerated: 14,
      },
    },
  ];

  return clauses;
}

export async function GET() {
  try {
    // Возвращаем mockup данные
    const clauses = generateMockClauses();
    return NextResponse.json(clauses);
  } catch (error: any) {
    console.error("Ошибка при получении списка формулировок:", error);
    return NextResponse.json(
      { error: "Не удалось загрузить список формулировок" },
      { status: 500 }
    );
  }
}

