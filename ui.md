Опишу это как конкретные требования к UI, чтобы ты мог почти дословно отдать дизайнеру/разработчику.

---

## 1. Общий пользовательский сценарий

1. Пользователь заходит на страницу сервиса.
2. Вставляет текст договора (вставка или загрузка файла).
3. Нажимает кнопку «Обработать».
4. Видит прогресс-бар обработки (шаги/этапы).
5. После завершения — экран с:

   * исходным текстом договора;
   * сгенерированным интерфейсом (кнопки/элементы);
   * возможностью для каждого интерфейсного элемента увидеть, из какого фрагмента договора он взялся.

---

## 2. Экран «Загрузка договора»

### 2.1. Блок загрузки

**Элементы:**

* Заголовок:
  «Загрузите текст договора»
* Поле ввода текста (многострочный `textarea`):

  * placeholder: «Вставьте сюда текст договора или загрузите файл…»
  * минимальная высота: ~10–15 строк.
* Кнопка загрузки файла:

  * текст: «Загрузить файл»
  * формат на MVP: `.txt` (потом можно расширить на `.docx`, `.pdf`).
* Подсказка мелким текстом:
  «MVP: поддерживаются файлы .txt и текст, вставленный вручную.»

**Требования:**

* Если пользователь загрузил файл — контент файла показывается в `textarea`, чтобы он всегда видел, что именно уйдёт в обработку.
* Валидация:

  * Не давать отправить пустой текст.
  * Если размер файла слишком большой (например > 200–300 КБ) — явное сообщение об ограничении.

### 2.2. Кнопка запуска обработки

* Кнопка: «Обработать договор»
* Состояния:

  * **enabled** — когда есть непустой текст.
  * **disabled** — когда поле пустое или идёт обработка.
  * **loading** — когда обработка запущена:

    * кнопка блокируется;
    * текст меняется на «Обрабатываем…».

При нажатии:

* Отправляется запрос в бэкенд с текстом.
* Переход к состоянию с прогресс-баром (см. ниже).

---

## 3. Блок «Прогресс обработки»

### 3.1. Визуальный элемент

**Прогресс-бар** (горизонтальная полоса + подпись этапа):

* Этапы (пример для MVP):

  1. «Анализ структуры договора»
  2. «Выделение обязательств и действий»
  3. «Формирование интерфейсных элементов»
  4. «Сборка JSON-модели»

Отображение:

* Либо ступенчатый прогресс-бар со статусами (active/done/pending),
* Либо классический бар 0–100%, но с текстовым статусом текущего шага.

### 3.2. Состояния

* **Идёт обработка**:

  * Прогресс-бар движется.
  * Кнопка «Обработать договор» заблокирована.
* **Успешно завершено**:

  * Прогресс-бар доходит до 100%.
  * Появляется уведомление «Обработка завершена».
  * Переход к блоку просмотра результата.
* **Ошибка**:

  * Прогресс-бар останавливается с пометкой «Ошибка».
  * Показать сообщение: «Не удалось обработать договор. Попробуйте снова или сократите текст.»
  * Кнопка «Обработать договор» разблокируется.

---

## 4. Экран «Просмотр результата»

### 4.1. Общий layout

Рекомендованный layout: **два столбца**.

* **Левая колонка**: исходный текст договора.
* **Правая колонка**: сгенерированный интерфейс (кнопки, карточки действий, состояние).

Это критично, чтобы реализовать «клик по интерфейсному элементу → подсветка источника в тексте».

#### 4.1.1. Левая колонка — «Текст договора»

Элементы:

* Заголовок: «Текст договора»
* Просмотрщик текста:

  * вертикальный скролл;
  * разбивка на блоки/параграфы, каждому параграфу присвоен **ID** (например, `p1`, `p2`, `p3`).
  * Номера или якоря параграфов могут не показываться пользователю, но должны быть в DOM для привязки.
* Возможность подсветки:

  * по запросу интерфейса справа, определённые абзацы должны:

    * подсвечиваться фоном;
    * автоматически прокручиваться в видимую область.

#### 4.1.2. Правая колонка — «Интерфейс договора»

Секции:

1. **Карточка договора**:

   * Номер договора, дата, город.
   * Стороны: кратко «Заказчик», «Исполнитель».
   * Сумма (если известна).

2. **Список действий (кнопок)**:

   * Каждое действие — отдельная карточка:

     * Заголовок = `label` кнопки (например, «Оплатить предоплату»).
     * Краткое описание.
     * Пометка «Кто может нажать» (Заказчик / Исполнитель).
     * Видимость статуса:

       * «Доступно сейчас» / «Недоступно (условие: …)» — пока можно просто текстом.
     * Кнопка «Показать источник в договоре» (ключевое требование).
     * Опционально — чипы с `relatedClauses` (например: «п. 5.2», «п. 7.8»).

---

## 5. Как показать источник юр. текста для интерфейсного элемента

Это ключевая часть — трассировка UI → договор.

### 5.1. Требование к данным

Чтобы UI мог подсветить источник, от бэкенда (LLM) нужно получать для каждого элемента:

* либо **диапазоны символов** исходного текста:
  `{"charStart": 523, "charEnd": 612}`
* либо **список ID параграфов**:
  `{"paragraphIds": ["p12", "p13"]}`

На уровне требований к интерфейсу:

* JSON для каждого `action` должен содержать поле типа `sourceRefs`:

  ```json
  "sourceRefs": [
    {
      "paragraphIds": ["p12", "p13"],
      "comment": "Условия предоплаты и сроки"
    }
  ]
  ```
* UI должен уметь:

  * получить этот список;
  * найти соответствующие параграфы в левом столбце;
  * подсветить их.

### 5.2. UI-поведение

Для **каждой карточки действия** справа:

* Добавить маленькую кнопку/ссылку:

  * текст: «Показать источник»
  * при клике:

    1. Высветить соответствующие абзацы в левом столбце (подсветка фона, например).
    2. Прокрутить левый столбец к **первому** абзацу из `sourceRefs`.
    3. Отобразить небольшой тултип/плашку над текстом (опционально) с текстом:
       «Источник для действия: “Оплатить предоплату”»
* Повторный клик:

  * либо снимает подсветку,
  * либо оставляет (можно уточнить в UX, но на MVP достаточно одного клика — показать/скрыть).

### 5.3. Дополнительные детали

* Если у действия **несколько** источников:

  * подсвечивать все указанные абзацы.
* Если у действия в JSON `sourceRefs` нет:

  * всё равно показывать карточку действия,
  * вместо кнопки «Показать источник» — серый текст «Источник не найден».

---

## 6. Дополнительные требования/мелочи

### 6.1. Пустые / крайние случаи

* Если модель вернула пустой список `actions`:

  * показать блок: «Не удалось выделить интерфейсные действия из договора. Попробуйте другой текст или уменьшите объём.»
* Если в `contractState` мало данных (нет номера, суммы и т.п.):

  * показывать только то, что есть, без placeholder-фантазий.

### 6.2. UX для разработчика / дебага

Для внутреннего пользования (debug):

* Переключатель «Показать сырой JSON»:

  * раскрывает JSON, который вернул LLM.
  * помогает сверять `sourceRefs` и состояние.

---

## 7. Сжатый список требований (для ТЗ)

1. **Страница загрузки:**

   * Многострочный ввод текста договора + кнопка загрузки `.txt` файла.
   * Кнопка «Обработать договор» с блокировкой/разблокировкой.
   * Валидация на пустой текст и размер.

2. **Прогресс обработки:**

   * Визуальный прогресс-бар с этапами.
   * Состояния: в процессе, успешно, ошибка.
   * При успехе — переход к экрану просмотра.

3. **Просмотр результата:**

   * Двухколоночный layout:

     * слева — исходный текст с разбивкой на параграфы и возможностью подсветки;
     * справа — карточка договора + список действий/кнопок.
   * Для каждого действия отображать:

     * заголовок (label),
     * описание,
     * кто может выполнить,
     * статус доступности (по данным `preconditions`).

4. **Связка интерфейс → текст договора:**

   * У каждого действия есть `sourceRefs` (параграфы или диапазоны символов).
   * У действия — кнопка «Показать источник».
   * При клике:

     * подсвечиваются соответствующие параграфы слева,
     * текст скроллится к первому параграфу,
     * опционально показывается тултип.

5. **Fallback:**

   * Если нет `actions` — сообщение об этом.
   * Если у конкретного действия нет `sourceRefs` — показать текст «Источник не найден».

Если хочешь, дальше могу:

* описать JSON-формат `sourceRefs` и ID параграфов так, чтобы его было удобно парсить из Cursor/LLM;
* накидать пример React-компонента с двумя колонками и подсветкой параграфов.
